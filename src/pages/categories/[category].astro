---
import Layout from "../../layouts/Layout.astro";
import {
  getAllPosts,
  getPostsByCategory,
  CATEGORIES,
} from "../../lib/contentful";
import BlogList from "../../components/BlogList.astro";

export async function getStaticPaths() {
  // Generate paths for all predefined categories except "all"
  return CATEGORIES.filter((cat) => cat.id !== "all").map((category) => ({
    params: { category: category.id },
  }));
}

const category = (Astro.params.category || "").toLowerCase();
const posts = await getPostsByCategory(category);

// Find the category label for display
const categoryInfo = CATEGORIES.find((cat) => cat.id === category);
const categoryLabel = categoryInfo ? categoryInfo.label : category;
---

<Layout>
  <Fragment slot="head">
    <title>「{categoryLabel}」カテゴリの投稿一覧 | notes.kinokonoko.io</title>
  </Fragment>
  <main class="container max-w-3xl mx-auto px-4 py-8">
    <h1 class="text-3xl font-bold mb-4">
      「{categoryLabel}」カテゴリの投稿一覧
    </h1>
    {
      posts.length === 0 ? (
        <p>このカテゴリに該当する投稿はありません。</p>
      ) : (
        <BlogList posts={posts} />
      )
    }
  </main>
</Layout>
